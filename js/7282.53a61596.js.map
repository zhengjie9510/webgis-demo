{"version":3,"file":"js/7282.53a61596.js","mappings":"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","sources":["webpack://webgis/./src/components/public/wind_field.vue","webpack://webgis/./src/components/public/wind_field.vue?f184"],"sourcesContent":["<template>\n  <div id=\"cesiumContainer\"></div>\n</template>\n\n<script>\nimport 'cesium/Build/Cesium/Widgets/widgets.css'\nimport * as Cesium from 'cesium'\nconst data = require('../../../public/SampleData/field.json')\n\nclass Field {\n  constructor(obj) {\n    this.init(obj)\n  }\n\n  init(obj) {\n    this.header = obj[0].header\n    this.left = this.header.left\n    this.top = this.header.top\n    this.right = this.header.right\n    this.bottom = this.header.bottom\n    this.rows = this.header.ny\n    this.cols = this.header.nx\n    this.dx = this.header.dx\n    this.dy = this.header.dy\n\n    const u_component = obj[0].data\n    const v_component = obj[1].data\n    const z_component = obj[2].data\n\n    this.grid = []\n    for (let i = 0; i < this.rows; i++) {\n      const row = []\n      for (let j = 0; j < this.cols; j++) {\n        const index = i * this.cols + j\n        const u = u_component[index]\n        const v = v_component[index]\n        const z = z_component[index]\n        row.push([u, v, z])\n      }\n      this.grid.push(row)\n    }\n  }\n\n  /**\n   * Calculates the u, v, and z components of the wind field at a given point (x, y) using bilinear interpolation.\n   * \n   * @param {number} x - The x-coordinate of the target point.\n   * @param {number} y - The y-coordinate of the target point.\n   * @returns {Array} - An array containing the u, v, and z components of the wind field at the target point.\n   */\n  getUVZ(x, y) {\n    const x0 = Math.floor((x - this.left) / this.dx);\n    const y0 = Math.floor((this.top - y) / this.dy);  // 调整y轴的计算\n    const x1 = x0 + 1;\n    const y1 = y0 + 1;\n\n    const grid00 = this.grid[y0][x0];\n    const grid01 = this.grid[y0][x1];\n    const grid10 = this.grid[y1][x0];\n    const grid11 = this.grid[y1][x1];\n\n    const u00 = grid00[0];\n    const v00 = grid00[1];\n    const z00 = grid00[2];\n\n    const u01 = grid01[0];\n    const v01 = grid01[1];\n    const z01 = grid01[2];\n\n    const u10 = grid10[0];\n    const v10 = grid10[1];\n    const z10 = grid10[2];\n\n    const u11 = grid11[0];\n    const v11 = grid11[1];\n    const z11 = grid11[2];\n\n    const dx = (x - this.left) / this.dx - x0;\n    const dy = (this.top - y) / this.dy - y0;\n\n    const a = (1 - dx) * (1 - dy);\n    const b = dx * (1 - dy);\n    const c = (1 - dx) * dy;\n    const d = dx * dy;\n\n    const u = a * u00 + b * u01 + c * u10 + d * u11;\n    const v = a * v00 + b * v01 + c * v10 + d * v11;\n    const z = a * z00 + b * z01 + c * z10 + d * z11;\n    return { u, v, z };\n  }\n\n  isInBound(x, y) {\n    return x >= this.left && x <= this.right - this.dx && y >= this.bottom + this.dx && y <= this.top\n  }\n}\n\nclass LineParticle {\n  /**\n   * @param {Cesium.PolylineCollection} particleCollection\n   * @param {Field} field\n   */\n  constructor(particleCollection, field) {\n    this.x = undefined\n    this.y = undefined\n    this.z = undefined\n    this.u = undefined\n    this.v = undefined\n    this.tx = undefined\n    this.ty = undefined\n    this.tz = undefined\n    this.age = undefined\n    this.maxAge = 100\n    this.maxNum = 20\n    this.speed = 1\n    this.field = field\n    this.particles = []\n    this.particleCollection = particleCollection\n    this.color = new Cesium.Color(1.0, 0.0, 0.0, 1.0)\n    this.width = 2\n  }\n\n  init() {\n    this.age = Math.random() * this.maxAge\n    let start = this.randomPosition()\n    let uvz = this.field.getUVZ(start.x, start.y)\n    this.x = start.x, this.y = start.y, this.z = uvz.z\n    this.u = uvz.u, this.v = uvz.v\n  }\n\n  randomPosition() {\n    const x = this.field.left + Math.random() * (this.field.right - this.field.left - this.field.dx)\n    const y = this.field.bottom + this.field.dy + Math.random() * (this.field.top - this.field.bottom - this.field.dy)\n    return { x, y }\n  }\n\n  getNextPosition(x, y, u, v) {\n    const dx = u * this.speed\n    const dy = v * this.speed\n    const tx = x + dx\n    const ty = y - dy\n    return { tx, ty }\n  }\n\n  updateParticle() {\n    if (this.age <= 0) {\n      for (let i = 0; i < this.particles.length; i++) {\n        this.particleCollection.remove(this.particles[i])\n      }\n      this.particles = []\n      this.init()\n    }\n\n    if (this.particles.length > this.maxNum) {\n      this.particleCollection.remove(this.particles[0])\n      this.particles.shift()\n    }\n\n    this.particles.forEach((particle) => {\n      particle.material.uniforms.color.alpha -= (1 / this.maxNum)\n    })\n\n    let next = this.getNextPosition(this.x, this.y, this.u, this.v)\n    if (this.field.isInBound(next.tx, next.ty)) {\n      this.tx = next.tx, this.ty = next.ty\n      let uvz = this.field.getUVZ(this.tx, this.ty)\n      this.tz = uvz.z\n      this.u = uvz.u, this.v = uvz.v\n      const particle = this.particleCollection.add({\n        positions: [new Cesium.Cartesian3(this.x, this.y, this.z), new Cesium.Cartesian3(this.tx, this.ty, this.tz)],\n        width: this.width,\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Color',\n            uniforms: {\n              color: this.color.clone(),\n            }\n          }\n        })\n      })\n      this.particles.push(particle)\n      this.x = this.tx, this.y = this.ty, this.z = this.tz\n\n      this.age = this.age - 1\n    }\n    else {\n      this.age = 0\n    }\n  }\n}\n\nclass ParticleSystem {\n  constructor(obj) {\n    this.maxNum = 500\n    this.lineParticles = []\n    this.field = new Field(obj)\n    this.particleCollection = new Cesium.PolylineCollection()\n  }\n\n  init() {\n    for (let i = 0; i < this.maxNum; i++) {\n      const lineParticle = new LineParticle(this.particleCollection, this.field)\n      lineParticle.init()\n      this.lineParticles.push(lineParticle)\n    }\n  }\n\n  update() {\n    this.lineParticles.forEach((lineParticle) => {\n      lineParticle.updateParticle()\n    })\n  }\n}\n\nconst particleSystem = new ParticleSystem(data)\n\nexport default {\n  mounted() {\n    this.init()\n  },\n  methods: {\n    async init() {\n      var viewer = new Cesium.Viewer('cesiumContainer', { terrainProvider: await Cesium.createWorldTerrainAsync() })\n      if (Cesium.FeatureDetection.supportsImageRenderingPixelated()) {\n        viewer.resolutionScale = window.devicePixelRatio\n      }\n      viewer.scene.debugShowFramesPerSecond = true\n      viewer.scene.globe.depthTestAgainstTerrain = true\n      viewer.camera.setView({\n        destination: Cesium.Cartesian3.fromDegrees(116.4, 39.895, 1000),\n        orientation: {\n          heading: Cesium.Math.toRadians(0),\n          pitch: Cesium.Math.toRadians(-60),\n          roll: Cesium.Math.toRadians(0),\n        }\n      })\n\n      const modelCenter = Cesium.Cartesian3.fromDegrees(116.4, 39.9, 50)\n      const modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(modelCenter)\n\n      particleSystem.init()\n      particleSystem.particleCollection.modelMatrix = modelMatrix\n      viewer.scene.primitives.add(particleSystem.particleCollection)\n\n      setInterval(() => {\n        particleSystem.update()\n      }, 50)\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n#cesiumContainer {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n}\n</style>\n","import { render } from \"./wind_field.vue?vue&type=template&id=635d9ff0&scoped=true\"\nimport script from \"./wind_field.vue?vue&type=script&lang=js\"\nexport * from \"./wind_field.vue?vue&type=script&lang=js\"\n\nimport \"./wind_field.vue?vue&type=style&index=0&id=635d9ff0&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/zhengjie/Documents/webgis/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-635d9ff0\"]])\n\nexport default __exports__"],"names":["id","_createElementBlock","_hoisted_1","data","require","Field","constructor","obj","this","init","header","left","top","right","bottom","rows","ny","cols","nx","dx","dy","u_component","v_component","z_component","grid","i","row","j","index","u","v","z","push","getUVZ","x","y","x0","Math","floor","y0","x1","y1","grid00","grid01","grid10","grid11","u00","v00","z00","u01","v01","z01","u10","v10","z10","u11","v11","z11","a","b","c","d","isInBound","LineParticle","particleCollection","field","undefined","tx","ty","tz","age","maxAge","maxNum","speed","particles","color","Cesium","width","random","start","randomPosition","uvz","getNextPosition","updateParticle","length","remove","shift","forEach","particle","material","uniforms","alpha","next","add","positions","fabric","type","clone","ParticleSystem","lineParticles","lineParticle","update","particleSystem","mounted","methods","async","viewer","terrainProvider","resolutionScale","window","devicePixelRatio","scene","debugShowFramesPerSecond","globe","depthTestAgainstTerrain","camera","setView","destination","orientation","heading","pitch","roll","modelCenter","modelMatrix","primitives","setInterval","__exports__","render"],"sourceRoot":""}